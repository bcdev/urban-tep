<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>

<wps:Execute service="WPS"
             version="1.0.0"
             xmlns:wps="http://www.opengis.net/wps/1.0.0"
             xmlns:ows="http://www.opengis.net/ows/1.1"
             xmlns:xlink="http://www.w3.org/1999/xlink">

  <ows:Identifier>L3</ows:Identifier>

  <wps:DataInputs>

    <wps:Input>
      <ows:Identifier>productionName</ows:Identifier>
      <wps:Data>
        <wps:LiteralData>TEP timescan msi hochiminh</wps:LiteralData>
      </wps:Data>
    </wps:Input>
    <wps:Input>
      <ows:Identifier>processorBundleName</ows:Identifier>
      <wps:Data>
        <wps:LiteralData>calvalus-landsat</wps:LiteralData>
      </wps:Data>
    </wps:Input>
    <wps:Input>
      <ows:Identifier>processorBundleVersion</ows:Identifier>
      <wps:Data>
        <wps:LiteralData>1.0</wps:LiteralData>
      </wps:Data>
    </wps:Input>

    <wps:Input>
      <ows:Identifier>inputPath</ows:Identifier>
      <wps:Data>
        <wps:LiteralData>/calvalus/projects/urban-tep/s2-idepix-v1.0/L2_of_S2A_.*_V${yyyy}${MM}${dd}.*seq$</wps:LiteralData>
      </wps:Data>
    </wps:Input>
    <wps:Input>
      <ows:Identifier>minDate</ows:Identifier>
      <wps:Data>
        <wps:LiteralData>2015-06-01</wps:LiteralData>
      </wps:Data>
    </wps:Input>
    <wps:Input>
      <ows:Identifier>maxDate</ows:Identifier>
      <wps:Data>
        <wps:LiteralData>2016-10-31</wps:LiteralData>
      </wps:Data>
    </wps:Input>
    <wps:Input>
      <ows:Identifier>periodLength</ows:Identifier>
      <wps:Data>
        <wps:LiteralData>487</wps:LiteralData>
      </wps:Data>
    </wps:Input>
    <wps:Input>
      <ows:Identifier>regionWKT</ows:Identifier>
         <wps:Data>
             <wps:LiteralData>POLYGON((106.21001049932467 10.350689960784472,106.21001049932467 11.249005244904005,107.12452319208158 11.249005244904005,107.12452319208158 10.350689960784472,106.21001049932467 10.350689960784472))</wps:LiteralData>
         </wps:Data>
    </wps:Input>

    <wps:Input>
      <ows:Identifier>calvalus.l3.parameters</ows:Identifier>
      <wps:Data>
        <wps:ComplexData>
          <parameters>
            <compositingType>MOSAICKING</compositingType>
            <planetaryGrid>org.esa.snap.binning.support.PlateCarreeGrid</planetaryGrid>
            <numRows>972000</numRows>
            <superSampling>1</superSampling>
            <maskExpr>! lc_invalid and ! lc_cloud</maskExpr>
            <variables>
              <variable>
                <name>ndbi</name>
                <expr>(B11 - B8A) / (B11 + B8A)</expr>
              </variable>
              <variable>
                <name>ndvi</name>
                <expr>(B8A - B4) / (B8A + B4)</expr>
              </variable>
              <variable>
                <name>ndwi</name>
                <expr>(B3 - B8A) / (B3 + B8A)</expr>
              </variable>
              <variable>
                <name>mndwi</name>
                <expr>(B3 - B11) / (B3 + B11)</expr>
              </variable>
            </variables>
            <aggregators>
              <aggregator>
                <type>MIN_MAX</type>
                <varName>ndbi</varName>
              </aggregator>
              <aggregator>
                <type>AVG</type>
                <varName>ndbi</varName>
              </aggregator>
              <aggregator>
                <type>PERCENTILE</type>
                <percentage>10</percentage>
                <varName>ndbi</varName>
              </aggregator>
              <aggregator>
                <type>PERCENTILE</type>
                <percentage>90</percentage>
                <varName>ndbi</varName>
              </aggregator>
              <aggregator>
                <type>MIN_MAX</type>
                <varName>ndvi</varName>
              </aggregator>
              <aggregator>
                <type>AVG</type>
                <varName>ndvi</varName>
              </aggregator>
              <aggregator>
                <type>PERCENTILE</type>
                <percentage>10</percentage>
                <varName>ndvi</varName>
              </aggregator>
              <aggregator>
                <type>PERCENTILE</type>
                <percentage>90</percentage>
                <varName>ndvi</varName>
              </aggregator>
              <aggregator>
                <type>MIN_MAX</type>
                <varName>ndwi</varName>
              </aggregator>
              <aggregator>
                <type>AVG</type>
                <varName>ndwi</varName>
              </aggregator>
              <aggregator>
                <type>PERCENTILE</type>
                <percentage>10</percentage>
                <varName>ndwi</varName>
              </aggregator>
              <aggregator>
                <type>PERCENTILE</type>
                <percentage>90</percentage>
                <varName>ndwi</varName>
              </aggregator>
              <aggregator>
                <type>MIN_MAX</type>
                <varName>mndwi</varName>
              </aggregator>
              <aggregator>
                <type>AVG</type>
                <varName>mndwi</varName>
              </aggregator>
              <aggregator>
                <type>PERCENTILE</type>
                <percentage>10</percentage>
                <varName>mndwi</varName>
              </aggregator>
              <aggregator>
                <type>PERCENTILE</type>
                <percentage>90</percentage>
                <varName>mndwi</varName>
              </aggregator>
            </aggregators>
          </parameters>
        </wps:ComplexData>
      </wps:Data>
    </wps:Input>

    <wps:Input>
      <ows:Identifier>calvalus.output.dir</ows:Identifier>
      <wps:Data>
        <wps:LiteralData>/calvalus/projects/urban-tep/timescan-msi-hochiminh</wps:LiteralData>
      </wps:Data>
    </wps:Input>
    <wps:Input>
      <ows:Identifier>calvalus.output.format</ows:Identifier>
      <wps:Data>
<!--        <wps:LiteralData>BigGeoTiff</wps:LiteralData> -->
        <wps:LiteralData>NetCDF4</wps:LiteralData>
      </wps:Data>
    </wps:Input>
    <wps:Input>
      <ows:Identifier>calvalus.output.compression</ows:Identifier>
      <wps:Data>
        <wps:LiteralData>none</wps:LiteralData>
      </wps:Data>
    </wps:Input>
    <wps:Input>
      <ows:Identifier>calvalus.output.prefix</ows:Identifier>
      <wps:Data>
        <wps:LiteralData>timescan-msi-idepix-hochiminh</wps:LiteralData>
      </wps:Data>
    </wps:Input>
    <wps:Input>
      <ows:Identifier>calvalus.output.postfix</ows:Identifier>
      <wps:Data>
        <wps:LiteralData>-v2</wps:LiteralData>
      </wps:Data>
    </wps:Input>

<!--
    <wps:Input>
      <ows:Identifier>calvalus.ql.parameters</ows:Identifier>
      <wps:Data>
        <wps:ComplexData>
          <parameters>
            <quicklooks>
              <config>
                <subSamplingX>1</subSamplingX>
                <subSamplingY>1</subSamplingY>
                <RGBAExpressions>ndbi_max,ndvi_max,ndwi_mean,</RGBAExpressions>
                <imageType>png</imageType>
              </config>
              <config>
                <subSamplingX>1</subSamplingX>
                <subSamplingY>1</subSamplingY>
                <RGBAExpressions>ndbi_max,ndvi_max,mndwi_mean,</RGBAExpressions>
                <imageType>png</imageType>
              </config>
            </quicklooks>
          </parameters>
        </wps:ComplexData>
      </wps:Data>
    </wps:Input>
-->

    <wps:Input>
      <ows:Identifier>calvalus.resume</ows:Identifier>
      <wps:Data><wps:LiteralData>true</wps:LiteralData></wps:Data>
    </wps:Input>
    <wps:Input>
      <ows:Identifier>calvalus.system.beam.pixelGeoCoding.useTiling</ows:Identifier>
      <wps:Data>
        <wps:LiteralData>true</wps:LiteralData>
      </wps:Data>
    </wps:Input>
    <wps:Input>
      <ows:Identifier>calvalus.hadoop.mapreduce.job.queuename</ows:Identifier>
      <wps:Data>
        <wps:LiteralData>high</wps:LiteralData>
      </wps:Data>
    </wps:Input>     
    <wps:Input>
      <ows:Identifier>calvalus.hadoop.mapreduce.map.maxattempts</ows:Identifier>
      <wps:Data>
        <wps:LiteralData>2</wps:LiteralData>
      </wps:Data>
    </wps:Input>
    <wps:Input>
        <ows:Identifier>calvalus.hadoop.mapreduce.map.java.opts</ows:Identifier>
        <wps:Data><wps:LiteralData>-Djava.awt.headless=true -Xmx3072M -XX:ReservedCodeCacheSize=100m</wps:LiteralData></wps:Data>
    </wps:Input>
    <wps:Input>
        <ows:Identifier>calvalus.hadoop.mapreduce.map.memory.mb</ows:Identifier>
        <wps:Data><wps:LiteralData>4096</wps:LiteralData></wps:Data>
    </wps:Input>
    <wps:Input>
        <ows:Identifier>calvalus.hadoop.mapreduce.reduce.java.opts</ows:Identifier>
        <wps:Data><wps:LiteralData>-Djava.awt.headless=true -Xmx5120M -XX:ReservedCodeCacheSize=100m</wps:LiteralData></wps:Data>
    </wps:Input>
    <wps:Input>
        <ows:Identifier>calvalus.hadoop.mapreduce.reduce.memory.mb</ows:Identifier>
        <wps:Data><wps:LiteralData>6144</wps:LiteralData></wps:Data>
    </wps:Input>
  </wps:DataInputs>

</wps:Execute>
